# K-Stock Insight 데이터 수집 스크립트

이 폴더에는 한국 주식 시장 데이터를 수집하고 관리하는 스크립트들이 포함되어 있습니다.

## 📁 스크립트 목록

### 🚀 `data_collector.py`
**용도**: 초기 데이터 구성 (전체 데이터 수집)

**기능**:
- 상장 종목 정보 수집 (stocks 테이블)
- 일별 시세 데이터 수집 (daily_prices 테이블)  
- 투자자 동향 데이터 수집 (investor_trends 테이블)
- 업종별 시세 데이터 수집 (sector_prices 테이블)
- 섹터 정보 수집 (sectors 테이블)

**실행 시점**: 
- 최초 데이터베이스 구성 시
- 전체 데이터 재수집이 필요한 경우

**특징**:
- 설정된 기간 전체 데이터를 수집
- 대량 데이터 처리에 최적화
- 진행률 표시 및 배치 처리
- 중간 저장 및 재시도 기능

### 🔄 `data_updater.py`
**용도**: 일일 데이터 업데이트 (증분 데이터 수집)

**기능**:
- 각 테이블의 마지막 날짜 확인
- 마지막 날짜 다음날부터 어제까지 데이터 수집
- 누락된 데이터 자동 보완
- 일별 자동 실행에 최적화

**실행 시점**:
- 매일 자동 실행 (cron job 등)
- 수동으로 최신 데이터 업데이트 시

**특징**:
- 효율적인 증분 업데이트
- 빠른 실행 속도
- 로그 및 에러 처리
- 중복 데이터 방지

## 🛠️ 사용 방법

### 초기 설정 시
```bash
# 전체 데이터 수집 (처음 한 번만)
python scripts/data_collector.py
```

### 일일 업데이트
```bash
# 최신 데이터만 업데이트 (매일 실행)
python scripts/data_updater.py
```

## ⚙️ 환경 설정

### 필수 패키지
```bash
pip install pykrx psycopg2-binary pandas tqdm
```

### 환경 변수
```bash
export DB_HOST=localhost
export DB_PORT=5432  
export DB_NAME=k_stock_insight
export DB_USER=your_username
export DB_PASSWORD=your_password
```

## 📊 데이터 수집 현황

### 현재 수집된 데이터 (2025년 1월 기준)
- **종목 수**: 2,761개 (KOSPI + KOSDAQ)
- **일별 시세**: 276,647개 레코드
- **투자자 동향**: 2,105개 레코드  
- **업종별 시세**: 4,949개 레코드
- **수집 기간**: 2025-01-02 ~ 2025-06-04

### 데이터 소스
- **pykrx**: 한국거래소(KRX) 공식 API 래퍼
- **업데이트 주기**: 일 1회 (거래일 기준)
- **데이터 지연**: T+1 (전일 데이터 제공)

## 🔧 트러블슈팅

### 자주 발생하는 문제
1. **pykrx API 에러**: 네트워크 재시도 로직 포함
2. **데이터베이스 연결 실패**: 연결 설정 확인
3. **중복 데이터**: UPSERT 쿼리로 자동 처리
4. **메모리 부족**: 배치 처리로 해결

### 로그 파일
- `data_collection.log`: 전체 수집 로그
- `data_update.log`: 업데이트 로그

## 📈 성능 최적화

### data_collector.py
- 배치 크기: 50개씩 처리
- 커밋 주기: 배치당 1회
- 진행률 체크: 100개마다

### data_updater.py  
- 날짜별 증분 처리
- 효율적인 쿼리 최적화
- 빠른 실행을 위한 경량화

## 📝 개발 노트

### 아키텍처 결정 사항
- **단일 스크립트 vs 모듈화**: 유지보수성을 위해 기능별 분리
- **배치 처리**: 메모리 효율성과 안정성 확보
- **에러 처리**: 견고한 데이터 수집을 위한 재시도 로직
- **로깅**: 디버깅과 모니터링을 위한 상세 로그

### 향후 개선 계획
- [ ] 실시간 데이터 수집 기능 추가
- [ ] 웹 대시보드에서 수집 상태 모니터링
- [ ] 더 많은 투자자 유형 데이터 수집
- [ ] 데이터 품질 검증 기능 강화 